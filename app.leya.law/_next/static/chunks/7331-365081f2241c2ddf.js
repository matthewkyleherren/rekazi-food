"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7331],{62995:function(e,t,l){l.d(t,{X:function(){return s}});var a=l(651);let s=e=>{let{className:t}=e;return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",className:t,children:[(0,a.jsx)("path",{d:"M3 6H15M3 10.5H11.2105M3 15H11.2105",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("path",{d:"M17 9.25V16.75M20.75 13H13.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}},63376:function(e,t,l){l.d(t,{y:function(){return b}});var a=l(651),s=l(27995),i=l(70681),n=l(53498),r=l(38815),o=l(27422),d=l(27012),c=l(11948),m=l(62408),u=l(80324),p=l.n(u),x=l(92379),h=l(54896);function v(e){let{color:t,onChange:l}=e,[s,i]=(0,x.useState)(!1);return(0,a.jsxs)(h.Z,{open:s,onOpenChange:i,children:[(0,a.jsx)(h.Z.Trigger,{asChild:!0,children:(0,a.jsx)(r.Ct,{color:t,className:"flex !h-4 !w-4 items-center justify-center hover:opacity-80",variant:"solid"})}),(0,a.jsx)(h.Z.Portal,{children:(0,a.jsxs)(h.Z.Content,{align:"center",side:"top",sideOffset:12,className:"p-1.5",children:[(0,a.jsx)("div",{className:"grid grid-cols-5 gap-3 p-1",children:m.yN.map(e=>(0,a.jsx)(r.hU,{variant:"ghost",size:"2",color:"gray",onClick:()=>{l(e),i(!1)},className:p()(t===e&&"bg-slate-4"),title:e.charAt(0).toUpperCase()+e.slice(1),children:(0,a.jsx)(r.Ct,{color:e,className:"h-4 w-4",variant:"solid"})},e))}),(0,a.jsx)(h.Z.Arrow,{className:"fill-white"})]})})]})}function b(){let{t:e}=(0,o.qM)(c.aD.TABULAR_REVIEW),{register:t,setFocus:l,getValues:u}=(0,d.Gc)(),{fields:p,append:x,remove:h,update:b}=(0,d.Dq)({name:"options"}),f=()=>{let e=Math.floor(Math.random()*m.yN.length),t=m.yN[e];(0,s.kG)(t,"color is required"),x({label:"",color:t})},j=e=>{h(e)},g=(e,t)=>{let l=u("options.".concat(e,".label"));b(e,{label:l,color:t})},y=(e,t)=>{""===e.target.value.trim()&&h(t)},N=(e,t)=>{let a=e.target.value;if("Enter"===e.key){""!==a.trim()&&f(),e.preventDefault(),e.stopPropagation();return}if("Backspace"===e.key&&""===a.trim()){h(t),t>0&&(l("options.".concat(t-1,".label")),e.preventDefault());return}};return(0,a.jsxs)("div",{className:"flex flex-col",children:[p.map((e,l)=>(0,a.jsxs)("div",{className:"group flex cursor-default items-center rounded-md p-1 py-0.5 pr-0.5 hover:bg-slate-2",children:[(0,a.jsx)(v,{color:e.color,onChange:e=>{g(l,e)}}),(0,a.jsx)("input",{...t("options.".concat(l,".label"),{onBlur:e=>{y(e,l)}}),type:"text",className:"ml-1.5 mr-0.5 grow rounded-md border border-transparent bg-transparent px-1.5 py-1 text-xs text-slate-12 outline-none hover:border-slate-7 focus:border-lavendel-6",onKeyDown:e=>{N(e,l)}}),(0,a.jsx)(r.hU,{type:"button",variant:"ghost",size:"2",color:"gray",className:"invisible mx-0 group-hover:visible",tabIndex:-1,onClick:()=>{j(l)},children:(0,a.jsx)(i.Z,{className:"h-3.5 w-3.5 text-slate-10"})})]},e.id)),(0,a.jsxs)("div",{onClick:f,className:"mt-0.5 flex cursor-default items-center gap-2 rounded-md px-1.5 py-1.5 hover:bg-slate-2",children:[(0,a.jsx)(n.pOD,{className:"h-4 w-4 shrink-0 text-slate-10"}),(0,a.jsx)("span",{className:"text-xs text-slate-11",children:e("review.add_option","Add option")})]})]})}},98809:function(e,t,l){l.d(t,{t:function(){return p}});var a=l(651),s=l(70350),i=l(10636),n=l(87253),r=l(8319),o=l(85118),d=l(20347),c=l(52786),m=l(53498),u=l(62408);let p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,l={style:{flexShrink:0,width:t,height:t}};switch(e){case u.QD.Text:return(0,a.jsx)(s.Z,{...l});case u.QD.Boolean:return(0,a.jsx)(m.Wwj,{...l});case u.QD.BulletPoint:return(0,a.jsx)(i.Z,{...l});case u.QD.Number:return(0,a.jsx)(n.Z,{...l});case u.QD.Currency:return(0,a.jsx)(r.Z,{...l});case u.QD.Date:return(0,a.jsx)(o.Z,{...l});case u.QD.Duration:return(0,a.jsx)(d.Z,{...l});case u.QD.Tag:return(0,a.jsx)(c.Z,{...l});default:return null}}},47334:function(e,t,l){l.d(t,{f:function(){return p}});var a=l(651),s=l(50213),i=l(36541),n=l(80324),r=l.n(n),o=l(95182),d=l(54669),c=l(26073),m=l(4804),u=l(11948);function p(e){var t,l,n;let{templateId:p}=e,{user:x}=(0,m.aF)(),{organisation:h}=(0,c.xF)(),{t:v}=(0,u.qM)(u.aD.TABULAR_REVIEW_TEMPLATES),b=(0,i.NL)(),{data:f,isLoading:j}=(0,d.IKK)({templateId:p,userId:null!==(l=null==x?void 0:x.id)&&void 0!==l?l:"",organisationId:null!==(n=null==h?void 0:h.organisation.id)&&void 0!==n?n:""},{enabled:!!(x&&h)}),g=null==f?void 0:null===(t=f.favorite[0])||void 0===t?void 0:t.id,y="string"==typeof g,{mutateAsync:N}=(0,d.zoR)({onSuccess:()=>{b.invalidateQueries({queryKey:["TabularReviewTemplateFavoriteState"]})}}),{mutateAsync:w}=(0,d.Ihy)({onSuccess:()=>{b.invalidateQueries({queryKey:["TabularReviewTemplateFavoriteState"]})}}),T=async()=>{if(y)await w({id:g});else{if("string"!=typeof(null==x?void 0:x.id)||"string"!=typeof(null==h?void 0:h.organisation.id))return;await N({templateId:p,userId:x.id,organisationId:h.organisation.id})}};return(0,a.jsxs)("div",{className:"group flex items-center gap-1 rounded-lg border border-transparent px-1 py-0.5 hover:border-slate-5 hover:bg-slate-4",role:"button",onClick:e=>{e.stopPropagation(),T()},children:[(0,a.jsx)(s.Z,{className:r()("h-4 w-4 shrink-0",y?"text-blue-9 group-hover:text-blue-10":"text-slate-7 group-hover:text-slate-9")}),j?null:(0,a.jsx)(o.E.p,{initial:{opacity:0},animate:{opacity:1},className:"text-xxs font-medium text-slate-9 group-hover:text-slate-10",children:y?v("save-fav.template-is-favorite","Saved as favorite"):v("save-fav.save-template-as-favorite","Save as favorite")})]})}},31534:function(e,t,l){l.d(t,{r:function(){return m}});var a=l(651),s=l(80324),i=l.n(s),n=l(70517),r=l.n(n),o=l(11948),d=l(98809),c=l(1301);let m=e=>{let{column:t,viewType:l}=e,{t:s}=(0,o.qM)(o.aD.TABULAR_REVIEW_TEMPLATES),n=!r()(t.description)&&t.description.length>0;return(0,a.jsxs)("div",{className:i()("rounded-lg border border-slate-3 bg-slate-2 p-2.5",l!==c.vQ.Preview?l===c.vQ.Full?"dark:bg-slate-1 dark:group-hover/template-card:bg-slate-1":"dark:bg-slate-2 dark:group-hover/template-card:bg-slate-3":null,l!==c.vQ.Preview&&"group-hover/template-card:bg-slate-3"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3 pb-1",children:[(0,a.jsx)("p",{className:"text-xs font-medium",children:t.name}),(0,d.t)(t.type,10)]}),(0,a.jsx)("p",{className:i()("text-xxs",n?"text-slate-11":"text-slate-9"),children:n?t.description:s("col-list.prompt-undefined","Prompt not defined â€” only label will be used as prompt")})]})}},1301:function(e,t,l){l.d(t,{Tx:function(){return n},cn:function(){return x},vQ:function(){return i}});var a,s,i,n,r=l(651),o=l(80324),d=l.n(o),c=l(95182),m=l(92379),u=l(76850),p=l(31534);(a=i||(i={})).Featured="featured",a.Full="full",a.Preview="preview",(s=n||(n={})).Minimized="minimized",s.Expanded="expanded";let x=e=>{let{columns:t,viewType:l,viewMode:a}=e,[s,i]=m.useState(0),[n,o]=m.useState(0);return(0,r.jsxs)("div",{className:d()("flex grow flex-col gap-1 overflow-hidden"),children:[(0,r.jsxs)("p",{className:"pl-0.5 text-xs font-medium",children:[t.length," ",1===t.length?"column":"columns"]}),(0,r.jsxs)(c.E.div,{initial:!1,onScroll:e=>{i(e.currentTarget.scrollTop),o(e.currentTarget.scrollHeight-e.currentTarget.scrollTop-e.currentTarget.clientHeight)},animate:{height:(0,u.EQ)({viewType:l,viewMode:a}).with({viewType:"preview"},()=>"auto").with({viewType:"full",viewMode:"expanded"},()=>"auto").with({viewType:"full"},()=>170).otherwise(()=>void 0)},className:d()("relative flex min-h-[170px] grow flex-col gap-1.5 border-b border-t","preview"===l?"overflow-y-auto":"overflow-hidden","preview"===l&&s>3?"border-t-slate-4":"border-t-transparent","preview"===l&&n>3?"border-b-slate-4":"border-b-transparent"),children:[t.slice(0,"featured"===l?2:1e4).map(e=>(0,r.jsx)(p.r,{column:e,viewType:l},e.id)),"preview"===l?null:"minimized"===a&&t.length>("featured"===l?1:2)?(0,r.jsx)("div",{className:d()("absolute bottom-0 right-0 h-16 w-full bg-gradient-to-t from-white to-transparent group-hover/template-card:from-slate-2","full"===l?"dark:from-slate-2 dark:group-hover/template-card:from-slate-3":"dark:from-slate-3 dark:group-hover/template-card:from-slate-4")}):null]})]})}},51696:function(e,t,l){l.d(t,{v:function(){return r}});var a=l(651),s=l(76850),i=l(14104),n=l(11948);function r(e){let{isPublic:t,organisation:l,user:r}=e,o={size:"1"};return(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"pb-1 text-xxs font-medium text-slate-10",children:(0,a.jsx)(n.T,{keyName:"created-by",ns:"common",children:"Created by"})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,s.EQ)([null!=t&&t,l,r]).with([!0,s.P._,s.P._],()=>(0,a.jsx)(i.qE,{...o,shape:"square",src:"/logo/Leya-Symbol.svg"})).with([s.P._,s.P.nonNullable,s.P._],e=>{let[,t]=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.yN,{...o,name:t.name}),(0,a.jsx)("p",{className:"text-xxs font-medium",children:t.name})]})}).with([s.P._,s.P._,s.P.nonNullable],e=>{var t,l;let[,,s]=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Yt,{...o,userId:s.id,name:null!==(t=s.givenName)&&void 0!==t?t:s.email}),(0,a.jsx)("p",{className:"text-xxs font-medium",children:null!==(l=s.givenName)&&void 0!==l?l:s.email})]})}).otherwise(()=>null)})]})}},87331:function(e,t,l){l.d(t,{d:function(){return o},B:function(){return eG}});var a,s,i,n,r,o,d=l(651),c=l(61959),m=l(27860),u=l(50908),p=l(80324),x=l.n(p),h=l(92379),v=l(27012),b=l(27612),f=l(8774),j=l(10048),g=l(1899),y=l(54669),N=l(26073),w=l(4804),T=l(11948),E=l(21087),k=l(60353),_=l(47300),A=l(94332),C=l(84141),S=l(31594),Z=l(49390);let M=_.z.object({id:_.z.string().optional(),name:_.z.string().min(1),description:_.z.string(),columns:_.z.array(C.D).min(1)}),D=e=>{let{fromReview:t,fromTemplateId:l}=e,{data:a,isLoading:s}=(0,y.TNN)({id:null!=l?l:""},{enabled:void 0!==l,select:e=>e.template}),{data:i,isLoading:n}=(0,k.Dv)(S.T),{data:r,isLoading:o}=(0,k.Dv)(Z.n),d=(0,h.useMemo)(()=>null==i?void 0:i.columns.toSorted((e,t)=>e.order-t.order).map(e=>({id:(0,A.Vj)(),name:e.name,description:e.description,type:e.type,options:e.options})),[null==i?void 0:i.columns]);return{data:(0,h.useMemo)(()=>{var e,s,i,n,o,c,m;return void 0!==l?{id:null!==(e=null==a?void 0:a.id)&&void 0!==e?e:"",name:null!==(s=null==a?void 0:a.name)&&void 0!==s?s:"",description:null!==(i=null==a?void 0:a.description)&&void 0!==i?i:"",columns:null!==(n=null==a?void 0:a.columns)&&void 0!==n?n:[]}:t?{id:null!==(o=null==r?void 0:r.id)&&void 0!==o?o:"",name:null!==(c=null==r?void 0:r.name)&&void 0!==c?c:"",description:null!==(m=null==r?void 0:r.description)&&void 0!==m?m:"",columns:null!=d?d:[]}:{name:"",description:"",columns:[]}},[a,r,d,t,l]),isLoading:s||n||o}},L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=D({fromReview:e.fromReview,fromTemplateId:e.templateId}),l=(0,v.cI)({resolver:(0,E.F)(M),defaultValues:t.data,reValidateMode:"onChange",...e});return(0,h.useEffect)(()=>{l.reset(t.data)},[t.data]),{...l,isLoading:t.isLoading}},I=()=>(0,v.Gc)();function P(e,t){return t.toLowerCase().includes(e.toLowerCase())}(a=n||(n={})).EDIT="edit",a.COPY_TEMPLATE="copy-template",a.COPY_REVIEW="copy-review",a.NEW="new";var R=l(35191),O=l(95182),F=l(47334),q=l(1301),V=l(51696);function U(e){let{templateId:t,onUseTemplate:l,onEditTemplate:a,onCopyTemplate:s,editable:i=!1}=e,{t:n}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES),{t:r}=(0,T.qM)(T.aD.COMMON),[o,c]=(0,h.useState)(q.Tx.Minimized),{data:m}=(0,y.TNN)({id:t},{select:e=>e.template});return m?(0,d.jsx)(O.E.div,{transition:{ease:"easeInOut",duration:.2},initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"relative flex shrink-0 select-none flex-col overflow-hidden rounded-2xl border border-slate-4 bg-white py-6 hover:bg-slate-2 dark:bg-slate-2 dark:hover:bg-slate-3",children:(0,d.jsxs)("div",{className:"grid h-full grow grid-cols-5 gap-5 overflow-hidden px-6",children:[(0,d.jsxs)("div",{className:"col-span-2 flex grow flex-col",children:[(0,d.jsx)("div",{className:"relative flex -translate-x-1 pb-2",children:(0,d.jsx)(F.f,{templateId:m.id})}),(0,d.jsx)("p",{className:"truncate font-title text-base font-medium",children:m.name}),(0,d.jsx)("p",{className:"text-desc line-clamp-2 pt-1 text-xs text-slate-11",children:m.description}),(0,d.jsx)("div",{className:"mt-auto pt-5",children:(0,d.jsx)(V.v,{isPublic:m.public,organisation:m.published?m.organisation:void 0,user:m.user})})]}),(0,d.jsxs)("div",{className:"col-span-3 flex grow flex-col gap-5 overflow-hidden",children:[(0,d.jsx)(q.cn,{columns:m.columns,viewMode:o,viewType:q.vQ.Full}),(0,d.jsxs)("div",{className:"flex shrink-0 justify-between gap-4",children:[(0,d.jsx)("div",{children:"number"==typeof m.columns_count&&m.columns_count>2?(0,d.jsxs)("button",{className:"btn btn-soft btn-sm",onClick:()=>{c(e=>e===q.Tx.Minimized?q.Tx.Expanded:q.Tx.Minimized)},children:[r("show","Show")," ",o===q.Tx.Minimized?"more":"less"]}):null}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[i&&a&&(0,d.jsx)("button",{className:"btn btn-soft btn-sm",onClick:()=>{a(m.id)},children:r("edit","Edit")}),!i&&s&&(0,d.jsx)("button",{className:"btn btn-soft btn-sm",onClick:()=>{s(m.id)},children:r("copy","Copy")}),(0,d.jsxs)("button",{className:"btn btn-solid btn-sm",onClick:()=>{l(m.id)},children:[n("feat-card.use-template","Use template"),(0,d.jsx)(R.Z,{className:"h-3 w-3"})]})]})]})]})]})}):null}var Q=l(59129),z=l(45802),B=l(41432),W=l(38815),Y=l(14104),K=l(54896);(s=r||(r={})).ALL="all",s.ME="me",s.LEYA="leya",s.MY_ORGANISATION="myOrganisation";let G=e=>{var t,l,a,s,i;let{filter:n,setFilter:r,templates:o}=e,[m,u]=h.useState(""),{organisation:p}=(0,N.xF)(),{user:v}=(0,w.aF)(),{t:b}=(0,T.qM)(T.aD.COMMON),{data:f}=(0,y.ydV)({organisationId:null!==(t=null==p?void 0:p.organisation.id)&&void 0!==t?t:"",userId:null!==(l=null==v?void 0:v.id)&&void 0!==l?l:""},{enabled:!!(p&&v),select:e=>e.tabular_review_templates.flatMap(e=>{var t;return null!==(t=e.user)&&void 0!==t?t:[]})}),g=o.reduce((e,t)=>{if(e.all+=1,t.public?e.leya+=1:t.published&&(e.myOrganisation+=1),"string"==typeof t.created_by){var l;let a=t.created_by===(null==v?void 0:v.id)?"me":t.created_by;e[a]=(null!==(l=e[a])&&void 0!==l?l:0)+1}return e},{all:0,me:0,leya:0,myOrganisation:0}),E=H.concat(...null!==(a=null==f?void 0:f.map(e=>{var t;return{value:e.id,label:null!==(t=e.givenName)&&void 0!==t?t:e.email,type:"user"}}))&&void 0!==a?a:[]);return(0,d.jsx)("div",{className:"flex flex-wrap items-center gap-1",children:(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("p",{className:"pl-0.5 text-xxs text-slate-10",children:b("created-by","Created by")}),(0,d.jsxs)(K.Z,{children:[(0,d.jsx)(K.Z.Trigger,{asChild:!0,children:(0,d.jsxs)("button",{className:"btn btn-soft gap-6",children:[(0,d.jsx)("div",{className:"flex items-center gap-2",children:(0,d.jsx)($,{item:null!==(s=E.find(e=>e.value===n))&&void 0!==s?s:{value:"all",label:"All",type:"default"},count:null!==(i=g[n])&&void 0!==i?i:0})}),(0,d.jsx)(z.Z,{className:"h-4 w-4"})]})}),(0,d.jsxs)(K.Z.Content,{side:"bottom",sideOffset:5,align:"end",children:[(0,d.jsxs)(j.Z,{size:"2",className:"mb-3 shrink-0",children:[(0,d.jsx)(j.Z.Slot,{children:(0,d.jsx)(c.Z,{className:"h-4 w-4 shrink-0"})}),(0,d.jsx)(j.Z.TextSlot,{autoFocus:!0,placeholder:b("search","Search"),onChange:e=>{u(e.target.value)},value:m}),(0,d.jsx)(j.Z.Slot,{children:(0,d.jsx)(W.hU,{variant:"ghost",radius:"full",color:"gray",onClick:()=>{u("")},className:x()(0===m.length&&"opacity-0"),children:(0,d.jsx)(B.Z,{className:"h-4 w-4"})})})]}),E.flatMap(e=>{var t;return P(m,e.label)?(0,d.jsx)(J,{item:e,setFilter:r,filter:n,count:null!==(t=g[e.value])&&void 0!==t?t:0},e.value):[]})]})]})]})})},H=[{value:"all",label:"All",type:"default"},{value:"myOrganisation",label:"My organisation",type:"default"},{value:"leya",label:"Leya",type:"default"},{value:"me",label:"Me",type:"default"}],X=e=>{let{count:t}=e;return(0,d.jsx)("span",{className:"flex min-w-[18px] items-center justify-center rounded-full border border-slate-4 bg-slate-3 px-0.5 py-[1px] text-[10px] font-medium text-slate-12",children:t})},J=e=>{let{item:t,setFilter:l,filter:a,count:s}=e;return(0,d.jsx)(K.Z.Close,{children:(0,d.jsx)("div",{className:"dropdown-item hover:bg-slate-3",onClick:()=>{l(t.value)},children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("div",{className:"w-4 shrink-0",children:a===t.value?(0,d.jsx)(Q.Z,{className:"h-4 w-4"}):null}),(0,d.jsx)($,{item:t,count:s})]})})})},$=e=>{var t;let{item:l,count:a}=e,{user:s}=(0,w.aF)();return(0,d.jsxs)("div",{className:"flex items-center gap-2",children:["leya"===l.value?(0,d.jsx)("div",{className:"flex aspect-square h-6 w-6 items-center justify-center rounded-full bg-slate-3",children:(0,d.jsx)("img",{src:"/logo/Leya-Symbol.svg",className:"h-[11px] w-[11px] dark:invert"})}):"user"===l.type?(0,d.jsx)(Y.Yt,{userId:l.value,name:l.label,size:"1"}):"me"===l.value?(0,d.jsx)(Y.Yt,{userId:null!==(t=null==s?void 0:s.id)&&void 0!==t?t:"",name:null==s?void 0:s.givenName,size:"1"}):null,l.label," ",(0,d.jsx)(X,{count:a})]})};var ee=l(70517),et=l.n(ee),el=l(36541),ea=l(88805),es=l(79171);let ei=e=>{var t,l;let{templateId:a}=e,s=(0,el.NL)(),{user:i}=(0,w.aF)(),{t:n}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES),r=async()=>{await Promise.all([s.invalidateQueries({queryKey:["TabularReviewTemplate"]}),s.invalidateQueries({queryKey:["FeaturedTemplates"]}),s.invalidateQueries({queryKey:["NewTemplates"]}),s.invalidateQueries({queryKey:["UserRecentlyUsedTemplates"]}),s.invalidateQueries({queryKey:["UsageOrderedTemplates"]})])},{mutateAsync:o}=(0,y.N98)({onSuccess:r}),{mutateAsync:d}=(0,y.RQV)({onSuccess:r}),c=(0,y.TNN)({id:null!=a?a:""},{enabled:void 0!==a,select:e=>e.template}),m=void 0!==a,u=void 0===a,p=(null===(t=c.data)||void 0===t?void 0:t.created_by)===(null==i?void 0:i.id)||u,x=u||(null===(l=c.data)||void 0===l?void 0:l.created_by)===(null==i?void 0:i.id);return{query:c,isNewTemplate:u,isUserOwner:p,isEditable:x,data:c.data,delete:async()=>{if(!a)throw Error("Template ID is required");try{var e;await d({id:a}),es.c.capture("tabular_review:template_delete",{template_id:a}),ea.A.success({title:n("toast.template-deleted","Template {templateName} Deleted",{templateName:null===(e=c.data)||void 0===e?void 0:e.name})})}catch(e){ea.A.error({title:n("toast.failed-to-delete.title","Failed to Delete Template"),description:n("toast.failed-to-delete.description","Please try again")})}},upsert:async e=>{let{columns:t,...l}=e,s=m?"edit":"create";try{let{insert_tabular_review_templates_one:e}=await o({object:{...l,parameters:t,created_by:null==i?void 0:i.id,id:a}});return ea.A.success({title:n("toast.template-action","Template {templateName} {actionPastTense}",{templateName:null==e?void 0:e.name,actionPastTense:m?"edited":"created"})}),es.c.capture("tabular_review:template_".concat(s),{template_id:null==e?void 0:e.id,template_name:null==e?void 0:e.name,columns_count:null==e?void 0:e.parameters_count}),e}catch(e){ea.A.error({title:n("toast.failed-to-action","Failed to {action} template",{action:s}),description:n("toast.failed-to-action-description","Please try again.")})}}}};var en=l(44523),er=l(50532),eo=l(38180),ed=l(94887),ec=l(24659),em=l(62995),eu=l(53498),ep=l(760),ex=l.n(ep),eh=l(38310),ev=l(59465),eb=l(98809),ef=l(62408),ej=l(63376);let eg=Object.entries({text:"Text",bullet_point:"Bulleted list",boolean:"Yes/No",date:"Date",tag:"Tag"}).map(e=>{let[t,l]=e;return{label:l,value:t}}),ey=(0,A.V5)(),eN=_.z.object({id:_.z.string().optional(),name:_.z.string().min(1).max(75).trim(),description:_.z.string().max(2e3).trim(),type:_.z.nativeEnum(ef.QD),options:_.z.array(ef.xT).optional().nullable()});function ew(e){var t,l,a,s;let{defaultValues:i,isOpen:n,onClose:r,onSubmit:o}=e,{t:c}=(0,T.qM)(T.aD.TABULAR_REVIEW),{t:m}=(0,T.qM)(T.aD.COMMON),u=(0,v.cI)({resolver:(0,E.F)(eN),defaultValues:{id:null!==(t=null==i?void 0:i.id)&&void 0!==t?t:"",name:null!==(l=null==i?void 0:i.name)&&void 0!==l?l:"",description:null!==(a=null==i?void 0:i.description)&&void 0!==a?a:"",type:null!==(s=null==i?void 0:i.type)&&void 0!==s?s:ef.QD.Text,options:null==i?void 0:i.options}}),[p,b]=(0,h.useState)(!1),f=void 0!==i,j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u.handleSubmit(t=>{o({...t,id:f?i.id:(0,A.Vj)(),options:t.options}),!0===e.shouldClose&&r(),f?u.reset(t):u.reset()})};return(0,h.useEffect)(()=>{var e,t,l,a;u.reset({id:null!==(e=null==i?void 0:i.id)&&void 0!==e?e:"",name:null!==(t=null==i?void 0:i.name)&&void 0!==t?t:"",description:null!==(l=null==i?void 0:i.description)&&void 0!==l?l:"",type:null!==(a=null==i?void 0:i.type)&&void 0!==a?a:ef.QD.Text,options:null==i?void 0:i.options})},[i]),(0,d.jsxs)(g.Z,{open:n||p,onOpenChange:e=>{e||(b(!1),r())},children:[(0,d.jsx)(g.Z.Overlay,{}),(0,d.jsxs)(g.Z.Content,{children:[(0,d.jsx)(g.Z.Header,{title:f?c("review.edit-col","Edit column"):c("review.add-col","Add column")}),(0,d.jsx)(v.RV,{...u,children:(0,d.jsxs)("form",{onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),j({shouldClose:!(e.ctrlKey||e.metaKey)})())},onSubmit:e=>(e.stopPropagation(),e.preventDefault(),!1),children:[(0,d.jsx)(g.Z.Body,{children:(0,d.jsxs)("div",{className:"space-y-5",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-1.5",children:[(0,d.jsx)("label",{className:"block text-xs font-medium text-slate-11",children:c("review.label","Label")}),(0,d.jsx)(W.u,{content:c("review.enter-description","Enter a short, descriptive label for the column header."),children:(0,d.jsx)(ed.Z,{className:"h-3.5 w-3.5 shrink-0 text-slate-11"})})]}),(0,d.jsxs)(eh.Z,{variant:"solid",className:"relative mb-2 overflow-visible",children:[(0,d.jsx)(eh.Z.TextSlot,{autoFocus:!0,placeholder:c("review.renewal-term","Renewal term"),autoComplete:"off",...u.register("name",{required:!0,maxLength:75})}),(0,d.jsxs)("p",{className:x()("absolute -bottom-6 right-1 text-xs text-slate-11 opacity-0 transition-opacity duration-300",u.watch("name").length>37.5&&"opacity-100"),children:[u.watch("name").length,"/",75]})]})]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-1.5",children:[(0,d.jsx)("label",{className:"block text-xs font-medium text-slate-11",children:c("review.prompt","Prompt")}),(0,d.jsx)(W.u,{content:c("review.enter-prompt","Enter a short but detailed prompt that clearly defines the information you need extracted."),children:(0,d.jsx)(ed.Z,{className:"h-3.5 w-3.5 shrink-0 text-slate-11"})})]}),(0,d.jsxs)("div",{className:"relative mb-2",children:[(0,d.jsx)("textarea",{className:"textarea w-full",placeholder:c("review.renewal-term-after-expire","What is the renewal term after the initial term expires? This includes automatic extensions and unilateral extensions with prior notice."),rows:ex()(u.watch("description").length/50,4,12),...u.register("description",{maxLength:2e3}),autoComplete:"off"}),(0,d.jsxs)("p",{className:x()("absolute -bottom-4 right-1 text-xs text-slate-11 opacity-0 transition-opacity duration-300",u.watch("description").length>1e3&&"opacity-100"),children:[u.watch("description").length,"/",2e3]})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"type",className:"mb-2 mt-5 block text-xs font-medium text-slate-11",children:c("review.format","Format")}),(0,d.jsx)(v.Qr,{name:"type",control:u.control,render:e=>{let{field:t}=e;return(0,d.jsxs)(ev.Z,{defaultValue:"text",...t,onValueChange:e=>{t.onChange(e)},children:[(0,d.jsx)(ev.Z.Trigger,{asChild:!0,children:(0,d.jsxs)("button",{type:"button",className:"btn btn-outline shadow-none outline-none focus:outline-none",children:[(0,d.jsx)(W.kC,{align:"center",gap:"1",children:(0,d.jsx)(ev.Z.Value,{})}),(0,d.jsx)(ev.Z.Icon,{asChild:!0,children:(0,d.jsx)(eu.v4q,{className:"ml-2 h-3 w-3 shrink-0"})})]})}),(0,d.jsx)(ev.Z.Portal,{children:(0,d.jsx)(ev.Z.Content,{position:"popper",sideOffset:5,align:"start",style:{zIndex:500},children:eg.map(e=>(0,d.jsx)(ev.Z.Item,{value:e.value,children:(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,eb.t)(e.value,12),m(e.label.toLowerCase().replaceAll(" ","-"),e.label)]})},e.value))})})]})}})]}),u.watch("type")===ef.QD.Tag&&(0,d.jsxs)("div",{className:"space-y-1.5",children:[(0,d.jsx)("label",{className:"block text-xs font-medium text-slate-11",children:c("review.options","Options")}),(0,d.jsx)(ej.y,{})]})]})}),(0,d.jsxs)(g.Z.Footer,{children:[(0,d.jsxs)("div",{className:x()("mr-auto flex select-none flex-col justify-center gap-2 opacity-0 transition duration-100",u.formState.isValid&&"!opacity-100"),children:[!f&&(0,d.jsxs)("div",{className:"flex items-center justify-between gap-2 text-xs text-slate-11",children:[m("add-another","Add another"),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)("p",{className:"h-5 min-w-5 rounded-[4px] bg-black/[7%] p-0.5 text-center dark:bg-white/10",children:ey?"âŒ˜":"Ctrl"}),(0,d.jsx)("p",{className:"h-5 min-w-5 rounded-[4px] bg-black/[7%] p-0.5 text-center dark:bg-white/10",children:"â†µ"})]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between gap-1 text-xs text-slate-11",children:[f?m("save","Save"):m("done","Done"),(0,d.jsx)("p",{className:"h-5 min-w-5 rounded-[4px] bg-black/[7%] p-0.5 text-center dark:bg-white/10",children:"â†µ"})]})]}),!f&&(0,d.jsx)("button",{className:"btn btn-soft",disabled:!u.formState.isValid,onClick:j({shouldClose:!1}),children:c("review.add-another","Add another")}),(0,d.jsx)("button",{className:"btn btn-solid",disabled:!u.formState.isValid,onClick:j({shouldClose:!0}),children:f?m("save","Save"):m("done","Done")})]})]})})]})]})}var eT=l(68874),eE=l(42381),ek=l(70681),e_=l(45657);let eA=e=>{let{column:t,disabled:l=!1,onChange:a,onDeleteColumn:s}=e,[i,n]=(0,h.useState)(!1),{t:r}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES),o=!et()(t.description)&&t.description.length>0,{attributes:c,listeners:m,setNodeRef:u,setActivatorNodeRef:p,transform:v,transition:b,isDragging:f}=(0,eo.nB)({id:t.id,disabled:l}),j={"z-index":f?"10":void 0,transform:eT.ux.Transform.toString(v),transition:b};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ew,{isOpen:i,onClose:()=>{n(!1)},defaultValues:t,onSubmit:a}),(0,d.jsx)("div",{ref:u,style:j,children:(0,d.jsx)(O.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{height:0,opacity:0},layout:!f,children:(0,d.jsxs)(e_.Z,{size:"small",className:x()("relative mb-4 !flex-row gap-5",f&&"cursor-grabbing"),children:[(0,d.jsx)("span",{ref:p,...m,...c,className:x()("my-auto shrink-0 rotate-90 cursor-grab transition duration-300 hover:opacity-100",l&&"cursor-not-allowed",f?"opacity-100":"opacity-30"),children:(0,d.jsx)(eu.W1P,{className:"h-4 w-4 text-slate-10"})}),(0,d.jsxs)("div",{className:"flex w-full flex-col gap-1",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("div",{className:"text-slate-8",children:(0,eb.t)(t.type,14)}),(0,d.jsx)("p",{className:"max-w-[75%] select-none truncate text-sm font-medium text-slate-12",children:t.name})]}),(0,d.jsx)("p",{className:x()("text-desc max-w-[75%] select-none truncate font-medium text-slate-10",!o&&"text-slate-8"),children:o?t.description:r("col-list.prompt-undefined","Prompt not defined â€” only label will be used as prompt")})]}),l?null:(0,d.jsxs)("div",{className:"absolute right-3 top-3 flex items-center",children:[(0,d.jsx)(W.u,{content:r("col-list.edit-col","Edit column"),children:(0,d.jsx)(W.hU,{variant:"ghost",color:"gray",size:"1",my:"auto",type:"button",onClick:()=>{n(!0)},children:(0,d.jsx)(eE.Z,{className:"h-4 w-4 shrink-0 text-slate-10 transition"})})}),(0,d.jsx)(W.u,{content:r("col-list.del-col","Delete column"),children:(0,d.jsx)(W.hU,{variant:"ghost",color:"gray",size:"1",my:"auto",type:"button",onClick:()=>{s(t.id)},children:(0,d.jsx)(ek.Z,{className:"h-4 w-4 shrink-0 text-slate-10 transition"})})})]})]})})})]})},eC=e=>{let{isEditable:t,...l}=e,{t:a}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES),s=I(),i=(0,v.Dq)({name:"columns",keyName:"field_id",control:s.control}),[n,r]=(0,h.useState)(!1),[o,c]=(0,h.useState)(0),m=(0,en.Dy)((0,en.VT)(en.we));return(0,d.jsxs)("form",{...l,className:x()("block grow flex-col overflow-y-auto px-5 pb-5",l.className),onScroll:e=>{c(e.currentTarget.scrollTop)},children:[(0,d.jsx)("div",{className:x()("sticky top-0 z-10 h-[1px] w-full border-b transition-all duration-500",o>5?"border-b-slate-4":"border-b-transparent")}),(0,d.jsx)("p",{className:"pb-2 pt-2 text-xs font-medium text-slate-11",children:a("review-edit.name","Name")}),(0,d.jsx)(v.Qr,{control:s.control,name:"name",render:e=>{let{field:l}=e;return(0,d.jsxs)("div",{className:"relative mb-2",children:[(0,d.jsx)(j.Z,{children:(0,d.jsx)(j.Z.TextSlot,{...l,autoFocus:!0,placeholder:a("review-edit.edit-name-placeholder","Acquisition Legal DD #1"),maxLength:75,disabled:!t})}),(0,d.jsxs)("p",{className:x()("absolute -bottom-6 right-1 text-xs text-slate-11 opacity-0 transition-opacity duration-300",l.value.length>37.5&&"opacity-100"),children:[l.value.length,"/",75]})]})}}),(0,d.jsx)("p",{className:"mt-10 pb-2 text-xs font-medium text-slate-11",children:a("review-edit.description","Description")}),(0,d.jsx)(v.Qr,{control:s.control,name:"description",render:e=>{let{field:l}=e;return(0,d.jsxs)("div",{className:"relative mb-2",children:[(0,d.jsx)("textarea",{className:"textarea w-full",placeholder:t?a("review-edit.template-legal-review","Template for legal review process for acquisition DD. Includes a comprehensive checklist of questions regarding deal structures, regulatory compliance, intellectual property considerations, and potential liabilities."):a("review-edit.no-description","This template has no description."),rows:4,...l,maxLength:250,disabled:!t}),(0,d.jsxs)("p",{className:x()("absolute -bottom-4 right-1 text-xs text-slate-11 opacity-0 transition-opacity duration-300",l.value.length>125&&"opacity-100"),children:[l.value.length,"/",250]})]})}}),(0,d.jsx)("div",{className:"mb-4 mt-10 flex w-full justify-between",children:t?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{className:"text-xs font-medium text-slate-11",children:a("review-edit.cols","Columns")}),(0,d.jsxs)("button",{type:"button",className:"btn btn-sm btn-soft h-8",onClick:()=>{r(!0)},children:[(0,d.jsx)(em.X,{className:"h-5 w-5 text-slate-11"}),a("review-edit.add-col","Add column")]})]}):null}),(0,d.jsx)("div",{className:"flex flex-col",children:(0,d.jsx)(en.LB,{sensors:m,modifiers:[er.F4],collisionDetection:en.pE,onDragEnd:function(e){let{active:t,over:l}=e;if(!l)return;let a=i.fields.findIndex(e=>e.id===t.id),s=i.fields.findIndex(e=>e.id===l.id);i.move(a,s)},children:(0,d.jsx)(eo.Fo,{items:i.fields.map(e=>e.id),strategy:eo.qw,children:(0,d.jsx)(ec.M,{children:i.fields.map((e,l)=>(0,d.jsx)(eA,{column:e,disabled:!t,onChange:e=>{i.update(l,e)},onDeleteColumn:()=>{i.remove(l)}},e.id))})})})}),t?(0,d.jsxs)("div",{className:"mt-8 flex select-none gap-3 rounded-md border border-slate-3 bg-slate-3 p-4 text-slate-11 shadow-md dark:border-slate-5 dark:shadow-xl",children:[(0,d.jsx)(ed.Z,{className:"h-4 w-4 shrink-0"}),(0,d.jsx)("p",{className:"text-desc",children:a("review-edit.reusable-col-description","The columns you define here will be reusable across tabular reviews. Keep labels tidy and prompts as broad yet as specific as possible in order to maximise reusability.")})]}):null,(0,d.jsx)(ew,{isOpen:n,onClose:()=>{r(!1)},onSubmit:e=>{i.append(e)}})]})};var eS=l(23477),eZ=l(95830),eM=l(14478),eD=l(91228),eL=l(52646),eI=l(9807),eP=l(97004),eR=l(71136);let eO=e=>{var t;let{template:l}=e,{user:a}=(0,w.aF)(),{t:s}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES),i=(0,el.NL)(),n={onSuccess:(0,h.useCallback)(()=>{Promise.all([["TabularReviewTemplate"],["FeaturedTemplates"]].map(e=>i.invalidateQueries({queryKey:e})))},[i])},{mutateAsync:r}=(0,y.QM)(n),{mutateAsync:o}=(0,y.Plm)(n),{mutateAsync:c}=(0,y.ML)(n),{mutateAsync:m}=(0,y.BDE)(n),{mutateAsync:u}=(0,y.SUM)(n),{mutateAsync:p}=(0,y.GGk)(n),v=l.user?{...l.user,creator:!0}:void 0,b=l.created_by!==(null==a?void 0:a.id),f=l.members.map(e=>et()(e.user)?null:{...e.user,id:e.id}),j=(0,h.useMemo)(()=>{let e=[];return e.push(...f.filter(e=>null!==e)),void 0!==v&&e.push(v),e},[v,f]),N=l.groups.filter(e=>!!e.group).map(e=>({...e.group,id:e.id})),E=l.members.map(e=>e.user).filter(e=>"string"==typeof(null==e?void 0:e.id));return(0,d.jsxs)(g.Z,{onOpenChange:e=>{e&&eP.ZP.capture("tabular_review:share_template_open",{template_id:l.id})},children:[(0,d.jsx)(g.Z.Trigger,{asChild:!0,children:(0,d.jsx)("div",{className:"btn btn-solid btn-sm",children:b?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(eL.Z,{className:"h-3 w-3 shrink-0"}),s("share-template.shared-with","Shared with")]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(eI.Z,{className:"h-3 w-3 shrink-0"})," ",s("share-template.share","Share")]})})}),(0,d.jsx)(g.Z.Overlay,{children:(0,d.jsxs)(g.Z.Content,{children:[(0,d.jsx)(g.Z.Header,{title:b?s("share-template.share-with","Shared with"):s("share-template.share-template","Share template"),Icon:eL.Z,description:b?s("share-template.template-shared-with","This template is shared with"):s("share-template.share-with-members","Share your template with members of your organisation"),descriptionDefaultOpen:!0}),(0,d.jsx)(g.Z.Body,{className:x()("-mx-2 min-h-[100px] px-6",b&&"py-0"),children:(0,d.jsx)(eR.Z,{users:j,groups:N,excludeFromSearch:[null!==(t=null==a?void 0:a.id)&&void 0!==t?t:"",...E.map(e=>e.id),...l.groups.map(e=>e.group.id)],isPublished:l.published,setIsPublished:e=>{m({id:l.id,published:e})},enabledForAll:!!l.unrestricted,setIsEnabledForAll:e=>{c({templateId:l.id,unrestricted:e})},onSelectUser:e=>{r({row:{user_id:e.id,template_id:l.id,added_by:null==a?void 0:a.id}})},onRemoveUser:e=>{o({id:e.id})},onSelectUserGroup:e=>{u({object:{group_id:e.id,template_id:l.id,added_by:null==a?void 0:a.id}})},onRemoveUserGroup:e=>{p({id:e.id})},searchSettings:{user:!0,userGroup:!0},showUsersOnly:b})})]})})]})};var eF=l(31077),eq=l(10766),eV=l(6445),eU=l(59817),eQ=l(58236);let ez=e=>{let{template:t}=e,{t:l}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES),{user:a}=(0,w.aF)(),s=(0,el.NL)(),[i,n]=(0,h.useState)(null),r=(0,h.useCallback)(()=>{s.invalidateQueries({queryKey:["TabularReviewTemplate"]})},[s]),{mutateAsync:o}=(0,y.llD)({onSuccess:r}),{mutateAsync:c}=(0,y.N98)({onSuccess:r});return t.created_by!==(null==a?void 0:a.id)?null:(0,d.jsxs)(g.Z,{children:[(0,d.jsx)(g.Z.Trigger,{asChild:!0,children:(0,d.jsxs)("div",{className:"btn btn-solid btn-sm",children:[(0,d.jsx)(eF.Z,{className:"h-3 w-3 shrink-0"})," ",l("admin-template.button-trigger","Admin")]})}),(0,d.jsx)(g.Z.Overlay,{children:(0,d.jsxs)(g.Z.Content,{children:[(0,d.jsx)(g.Z.Header,{title:l("admin-template.dialog-title","Template admin"),Icon:eF.Z,description:l("admin-template.dialog-description","Handle this template across organisations"),descriptionDefaultOpen:!0}),(0,d.jsxs)(g.Z.Body,{className:"-mx-2 flex min-h-[100px] gap-4 px-6",children:[(0,d.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,d.jsx)("p",{className:"font-title text-sm font-medium",children:l("admin-template.make-public-title","Publishing")}),(0,d.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[(0,d.jsx)("label",{className:"block text-xs font-medium text-slate-11",children:l("admin-template.make-public","Make public for all users across all organisations in Leya")}),(0,d.jsx)(eU.Z,{checked:t.public,onCheckedChange:e=>{o({id:t.id,public:e}).then(()=>{es.c.capture("tabular_review_template:admin_public_update",{template_id:t.id,is_public:e})})}})]})]}),(0,d.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,d.jsx)("p",{className:"font-title text-sm font-medium",children:l("admin-template.copy-title","Copying")}),(0,d.jsxs)("div",{className:"flex flex-col justify-between gap-4",children:[(0,d.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[(0,d.jsx)("label",{className:"block text-xs font-medium text-slate-11",children:l("admin-template.search-copying-header","Copy this template to users in other organisations")}),(0,d.jsxs)("button",{className:"btn btn-sm btn-soft self-end",disabled:null===i,onClick:()=>{var e,a,s;i&&c({object:{name:t.name,description:t.description,parameters:t.columns,created_by:i.id,organisation_id:null!==(s=null===(a=i.roles)||void 0===a?void 0:null===(e=a[0])||void 0===e?void 0:e.organisationId)&&void 0!==s?s:null}}).then(()=>{ea.A.success({title:l("toast.template-copied","Template copied to user")}),es.c.capture("tabular_review_template:admin_copy",{template_id:t.id,template_name:t.name,target_user:i.email})}).catch(()=>{ea.A.error({title:l("toast.error-template-copy","Error copying template")})}).finally(()=>{n(null)})},children:[l("admin-template.search-copying-send","Send"),(0,d.jsx)(eq.Z,{className:"h-4 w-4"})]})]}),(0,d.jsx)(eQ.Z,{placeholder:"Find user",onSelectUser:n,searchModes:{usersInAllOrganisations:!0},disabled:null!==i}),i&&(0,d.jsx)(eB,{user:i,onRemove:()=>{n(null)}})]})]})]})]})})]})},eB=e=>{var t,l,a,s,i,n;let{user:r,onRemove:o}=e,{t:c}=(0,T.qM)(T.aD.COMMON);return(0,d.jsxs)("div",{className:"flex items-center justify-between gap-3 rounded-md p-2 pr-4 hover:bg-slate-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(Y.Yt,{name:null!==(i=null!==(s=r.givenName)&&void 0!==s?s:r.nickname)&&void 0!==i?i:"",userId:r.id}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("p",{className:"flex items-center gap-1 truncate text-xs font-medium",children:[null!==(n=r.givenName)&&void 0!==n?n:r.nickname," ",(null===(l=r.roles)||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.role)?"(".concat(null===(a=r.roles[0])||void 0===a?void 0:a.role,")"):""]}),(0,d.jsx)("p",{className:"text-xs text-slate-11",children:r.email})]})]}),(0,d.jsxs)(eV.Z,{children:[(0,d.jsx)(eV.Z.Trigger,{asChild:!0,children:(0,d.jsx)(W.hU,{variant:"ghost",color:"gray",size:"1",children:(0,d.jsx)(eu.nWS,{})})}),(0,d.jsx)(eV.Z.Portal,{children:(0,d.jsx)(eV.Z.Content,{className:"z-10",side:"bottom",align:"start",sideOffset:5,children:(0,d.jsx)(eV.Z.Item,{className:"text-xs text-slate-11",onClick:o,children:c("remove","Remove")})})})]})]})},eW=e=>{var t,l,a,s,i,n,r,o,c,m;let{template:u}=e,{t:p}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES),{user:x}=(0,w.aF)(),{organisation:h}=(0,N.xF)(),v=u.groups.filter(e=>!!e.group).map(e=>({...e.group,id:e.id})),b=u.members.map(e=>e.user).filter(e=>"string"==typeof(null==e?void 0:e.id)),f=u.created_by===(null==x?void 0:x.id),j=(0,k.Dv)(eM.t).includes(eD.i4.LEYA_CONTENT_MANAGER),g=u.public&&!f;return(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[g?(0,d.jsxs)("div",{className:"flex",children:[(0,d.jsx)("p",{className:"text-[10px] font-medium text-slate-10",children:p("share-template.created-by-leya","Created by Leya")}),(0,d.jsx)("div",{className:"ml-3 mr-4 h-[16px] w-[1px] rounded-full bg-slate-6 first:hidden"}),(0,d.jsx)("img",{src:"/logo/Leya-Symbol.svg",className:"h-auto w-[16px] shrink-0 object-contain dark:invert"})]}):null!==(n=u.unrestricted)&&void 0!==n&&n?(0,d.jsx)("p",{className:"text-[10px] font-medium text-slate-10",children:p("share-template.shared-with-org","Shared with {organisation}",{organisation:null==h?void 0:h.organisation.name})}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(eZ.Z,{numGroups:v.length}),(0,d.jsx)(eS.Z,{users:b,align:"right",numUsersShown:3})]}),g?null:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"mx-1 h-[16px] w-[1px] rounded-full bg-slate-6 first:hidden"}),(0,d.jsx)("div",{title:null!==(o=null!==(r=null===(t=u.user)||void 0===t?void 0:t.givenName)&&void 0!==r?r:null===(l=u.user)||void 0===l?void 0:l.nickname)&&void 0!==o?o:"",children:(0,d.jsx)(Y.Yt,{name:null!==(c=null===(a=u.user)||void 0===a?void 0:a.givenName)&&void 0!==c?c:null===(s=u.user)||void 0===s?void 0:s.nickname,userId:null!==(m=null===(i=u.user)||void 0===i?void 0:i.id)&&void 0!==m?m:"",size:"1",className:"border-slate-6 dark:border-slate-3"})})]})]}),!g&&(0,d.jsx)(eO,{template:u}),j&&(0,d.jsx)(ez,{template:u})]})},eY=e=>{var t,l;let{onGoBack:a,openEntry:s,onTemplateDeleted:i,onTemplateSaved:n,templateId:r}=e,c=ei({templateId:r}),m=I(),{t:u}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES),{t:p}=(0,T.qM)(T.aD.COMMON),{organisation:x}=(0,N.xF)(),[v,f]=(0,h.useState)(!1);return"string"==typeof r&&(null===(t=m.formState.defaultValues)||void 0===t?void 0:t.id)!==r?null:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(eK,{templateId:r}),(0,d.jsx)(eC,{id:"template-form",onSubmit:m.handleSubmit(async e=>{await c.upsert({name:e.name,description:e.description,columns:e.columns,...c.isNewTemplate||et()(c.data)?{organisation_id:null==x?void 0:x.organisation.id}:{id:c.data.id}}).then(e=>{"string"==typeof(null==e?void 0:e.id)&&n(e.id)})}),isEditable:c.isEditable}),(0,d.jsx)(g.Z.Footer,{children:(0,d.jsxs)("div",{className:"flex w-full justify-between px-5 pb-5",children:[(0,d.jsx)("button",{className:"btn btn-soft",onClick:a,children:s===o.All?p("back","Back"):p("cancel","Cancel")}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[c.isEditable&&!c.isNewTemplate&&m.formState.isDirty?(0,d.jsx)("button",{className:"btn btn-soft",onClick:()=>{m.reset()},children:u("edit.undo-changes","Undo changes")}):null,!c.isNewTemplate&&c.isEditable?(0,d.jsx)("button",{className:"btn btn-soft",onClick:()=>{f(!0)},children:u("edit.delete-template","Delete template")}):null,c.isEditable?(0,d.jsx)("button",{form:"template-form",className:"btn btn-solid",type:"submit",disabled:m.formState.isSubmitting||!m.formState.isValid,children:c.isNewTemplate?p("save","Save"):u("edit.save-changes","Save changes")}):null]})]})}),c.isNewTemplate?null:(0,d.jsx)(b.Z,{open:v,onOpenChange:f,title:u("edit.sure-delete","Are you sure you want to delete {templateName}?",{templateName:null===(l=c.data)||void 0===l?void 0:l.name}),description:u("edit.action-cannot-undone","This action cannot be undone."),onActionClick:()=>{c.delete().then(()=>{i()})},actionText:u("edit.delete-template","Delete template")})]})},eK=e=>{var t;let{templateId:l}=e,a=ei({templateId:l}),{t:s}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES);return(0,d.jsx)("div",{className:x()("flex flex-col items-end justify-between px-5",!a.isNewTemplate&&"pt-3"),children:(0,d.jsxs)("div",{className:"flex h-full w-full items-center justify-between gap-3 pb-3",children:[a.isNewTemplate?null:(0,d.jsxs)("p",{className:"text-desc shrink-0 pt-3 text-slate-12 empty:hidden",children:[a.isUserOwner?s("edit.editing","Editing"):s("edit.viewing","Viewing")," ",(0,d.jsx)("span",{className:"font-semibold",children:null===(t=a.data)||void 0===t?void 0:t.name})]}),et()(a.data)?null:(0,d.jsx)("div",{className:"flex h-full items-center gap-1",children:null!==a.data.created_by?(0,d.jsx)(eW,{template:a.data}):null})]})})};function eG(e){let{open:t,setOpen:l,openEntry:a,onUseTemplate:s,fromReview:i}=e,{t:r}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES),[o,c]=(0,h.useState)(null),u=!0===i&&"new"===a?{action:n.COPY_REVIEW}:o,p=L({templateId:(null==u?void 0:u.action)===n.EDIT?u.templateId:(null==u?void 0:u.action)===n.COPY_TEMPLATE?u.fromTemplateId:void 0,fromReview:i}),x=("new"===a||(null==u?void 0:u.action)!==void 0)&&!p.isLoading,[f,j]=(0,h.useState)(!1),y=e=>{p.formState.isDirty?j(!0):N(e)},N=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"back";("new"===a||null===u||"close"===e)&&l(!1),c(null),p.reset()};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(g.Z,{onOpenChange:e=>{e?l(!0):y("close")},open:t,children:[(0,d.jsx)(g.Z.Overlay,{}),(0,d.jsxs)(g.Z.Content,{className:"h-[min(95dvh,820px)] w-[min(95vw,800px)] pb-0",children:[(0,d.jsx)(g.Z.Header,{title:"all"===a?x?(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("h4",{className:"font-title text-[15px]",children:r("template.all-templates","All templates")}),(0,d.jsx)(m.Z,{className:"h-3 w-3 text-slate-9"}),(0,d.jsx)("h4",{className:"font-title text-[15px]",children:(null==u?void 0:u.action)===n.EDIT?p.watch("name"):r("template.new-template","New template")})]}):(0,d.jsx)("h4",{className:"font-title text-[15px]",children:r("template.all-templates","All templates")}):r("template.new-template","New template")}),(0,d.jsx)(g.Z.Body,{className:"-mx-5 flex flex-col overflow-hidden py-0",children:x?(0,d.jsx)(v.RV,{...p,children:(0,d.jsx)(eY,{templateId:(null==u?void 0:u.action)===n.EDIT?u.templateId:void 0,onGoBack:()=>{y("back")},onTemplateDeleted:()=>{c(null)},onTemplateSaved:e=>{if(!0===i){N("close");return}c({action:n.EDIT,templateId:e})},openEntry:a})}):(0,d.jsx)(eH,{onUseTemplate:s,onCopyTemplate:e=>{c({action:n.COPY_TEMPLATE,fromTemplateId:e})},onEditTemplate:e=>{c({action:n.EDIT,templateId:e})},onCreateNewTemplate:()=>{c({action:n.NEW})}})})]})]}),(0,d.jsx)(b.Z,{open:f,onOpenChange:j,title:r("template.unsaved-changes","You have unsaved changes"),description:r("template.back-discard-changes","Going back would discard your changes. Are you sure you want to go back?"),onActionClick:N,actionText:r("template.discard-changes","Discard changes")})]})}(i=o||(o={})).All="all",i.New="new";let eH=e=>{var t;let{onUseTemplate:l,onEditTemplate:a,onCopyTemplate:s,onCreateNewTemplate:i}=e,[n,o]=(0,h.useState)(r.ALL),[m,p]=(0,h.useState)(""),[v,b]=(0,h.useState)(0),{user:f}=(0,w.aF)(),{organisation:g}=(0,N.xF)(),{t:E,tCommon:k}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES),{data:_,isLoading:A}=(0,y.Pp3)({},{enabled:!!(g&&f)}),C=null!==(t=null==_?void 0:_.templates)&&void 0!==t?t:[],S=C.filter(e=>{if(!P(m,e.name))return!1;switch(n){case r.ALL:return!0;case r.LEYA:return e.public;case r.ME:return!e.public&&e.created_by===(null==f?void 0:f.id);case r.MY_ORGANISATION:return!e.public&&e.published;default:return e.created_by===n}});return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"sticky top-0 z-10 flex items-end gap-2 bg-white px-5 pb-3 pt-4 dark:bg-slate-1",children:[(0,d.jsxs)(j.Z,{className:"shrink-0",children:[(0,d.jsx)(j.Z.Slot,{children:(0,d.jsx)(c.Z,{className:"h-4 w-4 shrink-0"})}),(0,d.jsx)(j.Z.TextSlot,{placeholder:E("template.search-tabular-review-templates","Search among available tabular review templates"),value:m,onChange:e=>{p(e.target.value)}})]}),(0,d.jsx)(G,{filter:n,setFilter:e=>{o(e)},templates:C}),(0,d.jsxs)("button",{className:"btn btn-soft",onClick:i,children:[(0,d.jsx)(u.Z,{className:"h-3 w-3 text-slate-9"}),k("new","New")]})]}),(0,d.jsxs)("div",{className:"flex grow flex-col gap-3 overflow-y-auto px-5 pb-5",onScroll:e=>{b(e.target.scrollTop)},children:[(0,d.jsx)("div",{className:x()("sticky top-0 z-10 h-[1px] w-full border-b transition-all duration-500",v>5?"border-b-slate-4":"border-b-transparent")}),A?null:0===C.length?(0,d.jsx)(eX,{initialNumberOfTemplates:0,searchQuery:m,filter:n}):0===S.length?(0,d.jsx)(eX,{initialNumberOfTemplates:C.length,searchQuery:m,filter:n}):S.map(e=>(0,d.jsx)(U,{templateId:e.id,onUseTemplate:l,onEditTemplate:a,onCopyTemplate:s,editable:e.created_by===(null==f?void 0:f.id)},e.id))]})]})},eX=e=>{let{initialNumberOfTemplates:t,searchQuery:l,filter:a}=e,{t:s}=(0,T.qM)(T.aD.TABULAR_REVIEW_TEMPLATES);return(0,d.jsxs)("div",{className:"text-desc flex grow flex-col items-center justify-center gap-3 text-balance px-6 text-center font-medium text-slate-12",children:[(0,d.jsx)(f.Q,{className:"h-10 w-10 text-slate-12"}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("p",{className:"text-sm font-medium text-slate-12",children:0===t?s("template.no-templates","You have no templates yet"):s("template.no-templates-found","No templates found")}),(0,d.jsx)("p",{className:"text-xxs text-slate-10",children:0===t?s("template.no-templates-found-description","Templates can be reused and shared with people in your organisation."):"all"!==a?s("template.no-templates-found-description-filters","No templates match your filters."):s("template.no-templates-found-description-search","No templates match your search: {searchQuery}.",{searchQuery:l})})]})]})}}}]);